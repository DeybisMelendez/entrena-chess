<chess-board
    style="width: 400px"
    position="{{ puzzle.fen }}"
    orientation="{{ puzzle.orientation }}"
    draggable-pieces>
</chess-board>
<article>
    <p>Orientation: {{ puzzle.orientation }} </p>
    <p>Puzzle ID: {{ puzzle.puzzle_id }}</p>
    <p>Rating: {{ puzzle.rating }}</p>
    <p>Moves: {{ puzzle.moves|join:" " }}</p>
    <p>FEN: {{ puzzle.fen }}</p>
    <p>Themes: {{ puzzle.themes|join:", " }}</p>
    <p>Openings: {{ puzzle.openings|join:", " }}</p>
</article>

<script>
    const board = document.querySelector('chess-board');
    const game = new Chess('{{puzzle.fen}}');

    board.addEventListener('drag-start', (e) => {
        const {source, piece, position, orientation} = e.detail;

        // do not pick up pieces if the game is over
        if (game.game_over()) {
            e.preventDefault();
            return;
        }

        // only pick up pieces for the side to move
        if ((game.turn() === 'w' && piece.search(/^b/) !== -1) ||
            (game.turn() === 'b' && piece.search(/^w/) !== -1)) {
            e.preventDefault();
            return;
        }
    });

    board.addEventListener('drop', (e) => {
        const {source, target, setAction} = e.detail;

        // see if the move is legal
        const move = game.move({
            from: source,
            to: target,
            promotion: 'q' // NOTE: always promote to a queen for example simplicity
        });

        // illegal move
        if (move === null) {
            setAction('snapback');
        }

    });

    // update the board position after the piece snap
    // for castling, en passant, pawn promotion
    board.addEventListener('snap-end', (e) => {
    board.setPosition(game.fen());
    });
</script>